<!DOCTYPE html>
<html>
<head>
    <title>社群連結修復測試</title>
    <script src="assets/dompurify.min.js"></script>
    <script src="assets/security-utils.js"></script>
</head>
<body>
    <h1>DOMPurify 社群連結修復測試</h1>
    <div id="results"></div>
    
    <script>
        const testCases = [
            // 安全連結（應該通過）
            { input: '<a href="https://github.com/user">GitHub</a>', expected: 'pass', desc: 'HTTPS連結' },
            { input: '<a href="mailto:test@example.com">Email</a>', expected: 'pass', desc: 'Email連結' },
            { input: '<a href="tel:+1234567890">Phone</a>', expected: 'pass', desc: '電話連結' },
            
            // 危險連結（應該被過濾）
            { input: '<a href="javascript:alert(1)">XSS</a>', expected: 'block', desc: 'JavaScript協議' },
            { input: '<a href="data:text/html,<script>alert(1)</script>">Data URI</a>', expected: 'block', desc: 'Data URI' },
            { input: '<a onclick="alert(1)" href="#">Click</a>', expected: 'block', desc: '事件處理器' }
        ];
        
        const results = document.getElementById('results');
        let passCount = 0;
        
        testCases.forEach((test, index) => {
            const cleaned = SecurityUtils.sanitizeHTML(test.input);
            const div = document.createElement('div');
            div.style.cssText = 'margin: 10px 0; padding: 10px; border: 1px solid #ccc;';
            
            let status, color;
            if (test.expected === 'pass') {
                status = cleaned.includes('<a href=') ? 'PASS' : 'FAIL';
                color = status === 'PASS' ? 'green' : 'red';
            } else {
                status = (!cleaned.includes('javascript:') && !cleaned.includes('onclick')) ? 'PASS' : 'FAIL';
                color = status === 'PASS' ? 'green' : 'red';
            }
            
            if (status === 'PASS') passCount++;
            
            div.innerHTML = `
                <strong style="color: ${color}">${status}</strong> - ${test.desc}<br>
                <small>輸入: ${test.input.replace(/</g, '&lt;')}</small><br>
                <small>輸出: ${cleaned.replace(/</g, '&lt;')}</small>
            `;
            results.appendChild(div);
        });
        
        const summary = document.createElement('div');
        summary.style.cssText = 'margin: 20px 0; padding: 15px; background: #f0f0f0; font-weight: bold;';
        summary.textContent = `測試結果: ${passCount}/${testCases.length} 通過`;
        results.insertBefore(summary, results.firstChild);
    </script>
</body>
</html>
